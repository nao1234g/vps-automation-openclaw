apiVersion: v1
kind: ConfigMap
metadata:
  name: argocd-notifications-cm
  namespace: argocd
data:
  # Slacké€šçŸ¥ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆ
  template.app-deployed: |
    message: |
      âœ… *{{.app.metadata.name}}* ãŒãƒ‡ãƒ—ãƒ­ã‚¤ã•ã‚Œã¾ã—ãŸ

      *ç’°å¢ƒ:* {{.app.spec.destination.namespace}}
      *ãƒªãƒ“ã‚¸ãƒ§ãƒ³:* {{.app.status.sync.revision}}
      *ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹:* {{.app.status.sync.status}}

      <{{.context.argocdUrl}}/applications/{{.app.metadata.name}}|ArgoCD ã§ç¢ºèª>

  template.app-sync-failed: |
    message: |
      âŒ *{{.app.metadata.name}}* ã®åŒæœŸã«å¤±æ•—ã—ã¾ã—ãŸ

      *ç’°å¢ƒ:* {{.app.spec.destination.namespace}}
      *ã‚¨ãƒ©ãƒ¼:* {{.app.status.operationState.message}}

      <{{.context.argocdUrl}}/applications/{{.app.metadata.name}}|ArgoCD ã§ç¢ºèª>

  template.app-health-degraded: |
    message: |
      âš ï¸ *{{.app.metadata.name}}* ã®ãƒ˜ãƒ«ã‚¹ãŒä½ä¸‹ã—ã¦ã„ã¾ã™

      *ç’°å¢ƒ:* {{.app.spec.destination.namespace}}
      *ãƒ˜ãƒ«ã‚¹ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹:* {{.app.status.health.status}}

      <{{.context.argocdUrl}}/applications/{{.app.metadata.name}}|ArgoCD ã§ç¢ºèª>

  template.app-sync-running: |
    message: |
      ğŸ”„ *{{.app.metadata.name}}* ã‚’åŒæœŸä¸­...

      *ç’°å¢ƒ:* {{.app.spec.destination.namespace}}
      *ã‚¿ãƒ¼ã‚²ãƒƒãƒˆãƒªãƒ“ã‚¸ãƒ§ãƒ³:* {{.app.spec.source.targetRevision}}

  # Telegramé€šçŸ¥ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆ
  template.app-deployed-telegram: |
    message: |
      âœ… {{.app.metadata.name}} ãŒãƒ‡ãƒ—ãƒ­ã‚¤ã•ã‚Œã¾ã—ãŸ
      ç’°å¢ƒ: {{.app.spec.destination.namespace}}
      ãƒªãƒ“ã‚¸ãƒ§ãƒ³: {{.app.status.sync.revision}}

  template.app-sync-failed-telegram: |
    message: |
      âŒ {{.app.metadata.name}} ã®åŒæœŸã«å¤±æ•—ã—ã¾ã—ãŸ
      ç’°å¢ƒ: {{.app.spec.destination.namespace}}
      ã‚¨ãƒ©ãƒ¼: {{.app.status.operationState.message}}

  # ãƒˆãƒªã‚¬ãƒ¼å®šç¾©
  trigger.on-deployed: |
    - when: app.status.operationState.phase in ['Succeeded'] and app.status.health.status == 'Healthy'
      send: [app-deployed]

  trigger.on-sync-failed: |
    - when: app.status.operationState.phase in ['Failed', 'Error']
      send: [app-sync-failed]

  trigger.on-health-degraded: |
    - when: app.status.health.status == 'Degraded'
      send: [app-health-degraded]

  trigger.on-sync-running: |
    - when: app.status.operationState.phase in ['Running']
      send: [app-sync-running]

  # ã‚µãƒ¼ãƒ“ã‚¹è¨­å®š
  service.slack: |
    token: $slack-token
    username: ArgoCD
    icon: https://argoproj.github.io/argo-cd/assets/logo.png

  service.telegram: |
    token: $telegram-token

  # ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆè³¼èª­
  subscriptions: |
    - recipients:
        - slack:openclaw-deployments
      triggers:
        - on-deployed
        - on-sync-running
    - recipients:
        - slack:openclaw-alerts
      triggers:
        - on-sync-failed
        - on-health-degraded

---
apiVersion: v1
kind: Secret
metadata:
  name: argocd-notifications-secret
  namespace: argocd
type: Opaque
stringData:
  slack-token: "xoxb-your-slack-token"
  telegram-token: "your-telegram-bot-token"
