# ============================================================================
# OpenClaw VPS - Staging Environment Configuration
# ============================================================================
#
# ステージング環境用の環境変数設定例
# このファイルをコピーして使用: cp .env.staging.example .env
#
# ステージング環境の特徴:
# - 本番に近い設定（本番環境のテスト用）
# - デバッグログは有効だが最小限
# - 外部サービスは本番とは別（テスト用APIキー等）
# - パフォーマンステスト可能
#
# ============================================================================

# ----------------------------------------------------------------------------
# Environment
# ----------------------------------------------------------------------------

NODE_ENV=staging
ENVIRONMENT=staging

# ----------------------------------------------------------------------------
# Database Configuration
# ----------------------------------------------------------------------------

POSTGRES_USER=openclaw_staging
POSTGRES_PASSWORD=CHANGE_THIS_TO_STRONG_STAGING_PASSWORD
POSTGRES_DB=openclaw_staging

# Staging用のパフォーマンス設定（本番より少し軽め）
POSTGRES_SHARED_BUFFERS=512MB
POSTGRES_EFFECTIVE_CACHE_SIZE=1536MB
POSTGRES_WORK_MEM=8MB
POSTGRES_MAINTENANCE_WORK_MEM=256MB

# ----------------------------------------------------------------------------
# LLM Provider Configuration
# ----------------------------------------------------------------------------

# Anthropic Claude API（ステージング/テスト用APIキー）
ANTHROPIC_API_KEY=sk-ant-STAGING_KEY_HERE

# Staging Settings（本番とほぼ同じだが、コスト削減のため一部Haikuを使用）
ANTHROPIC_MODEL=claude-sonnet-4-5-20250929
ANTHROPIC_MAX_TOKENS=4096
ANTHROPIC_TEMPERATURE=0.7

# ステージング環境のレート制限（本番より少し緩め）
ANTHROPIC_REQUESTS_PER_MINUTE=75
ANTHROPIC_TOKENS_PER_DAY=5000000

# ----------------------------------------------------------------------------
# OpenClaw Configuration
# ----------------------------------------------------------------------------

# Application Settings
PORT=3000
LOG_LEVEL=info  # 本番と同じ

# Session & Security（本番用の強度だが、別のシークレット）
SESSION_SECRET=staging_session_secret_CHANGE_THIS_32_chars_min
JWT_SECRET=staging_jwt_secret_CHANGE_THIS_32_chars_min
JWT_EXPIRES_IN=24h

# CORS Settings（ステージングドメイン）
CORS_ORIGIN=https://staging.your-domain.com
ALLOWED_ORIGINS=https://staging.your-domain.com

# Hot Reload（ステージングでは無効）
WATCH=false

# ----------------------------------------------------------------------------
# Telegram Bot Configuration
# ----------------------------------------------------------------------------

# Telegram Bot Token（ステージング用ボット）
TELEGRAM_BOT_TOKEN=1234567890:STAGING_BOT_TOKEN_HERE

# Telegram Chat ID（テストチャンネル）
TELEGRAM_CHAT_ID=123456789

# Staging Settings
TELEGRAM_PARSE_MODE=Markdown
TELEGRAM_DISABLE_NOTIFICATION=false

# ----------------------------------------------------------------------------
# N8N Configuration
# ----------------------------------------------------------------------------

# N8N Basic Settings（ステージングサブドメイン）
N8N_HOST=n8n.staging.your-domain.com
N8N_PORT=5678
N8N_PROTOCOL=https
N8N_EDITOR_BASE_URL=https://n8n.staging.your-domain.com

# N8N Security（本番と同じ強度）
N8N_BASIC_AUTH_ACTIVE=true
N8N_BASIC_AUTH_USER=admin
N8N_BASIC_AUTH_PASSWORD=CHANGE_THIS_TO_STRONG_STAGING_PASSWORD

# N8N Encryption Key
N8N_ENCRYPTION_KEY=staging_encryption_key_32_characters_min

# N8N Execution Settings
EXECUTIONS_PROCESS=main
EXECUTIONS_MODE=regular
EXECUTIONS_TIMEOUT=300
EXECUTIONS_TIMEOUT_MAX=3600

# N8N Data Retention（ステージングでは短め）
EXECUTIONS_DATA_SAVE_ON_ERROR=all
EXECUTIONS_DATA_SAVE_ON_SUCCESS=all
EXECUTIONS_DATA_SAVE_MANUAL_EXECUTIONS=true
EXECUTIONS_DATA_PRUNE=true
EXECUTIONS_DATA_MAX_AGE=168  # 7 days

# N8N Timezone
GENERIC_TIMEZONE=Asia/Tokyo
TZ=Asia/Tokyo

# ----------------------------------------------------------------------------
# OpenNotebook Configuration
# ----------------------------------------------------------------------------

OPENNOTEBOOK_PORT=8080
OPENNOTEBOOK_HOST=0.0.0.0

# OpenNotebook Database
OPENNOTEBOOK_DB_HOST=postgres
OPENNOTEBOOK_DB_PORT=5432
OPENNOTEBOOK_DB_NAME=opennotebook_staging
OPENNOTEBOOK_DB_USER=openclaw_staging
OPENNOTEBOOK_DB_PASSWORD=${POSTGRES_PASSWORD}

# OpenNotebook Storage
OPENNOTEBOOK_UPLOAD_DIR=/app/uploads
OPENNOTEBOOK_MAX_FILE_SIZE=50MB

# ----------------------------------------------------------------------------
# Nginx Configuration
# ----------------------------------------------------------------------------

# Domain Settings（ステージングサブドメイン）
DOMAIN_NAME=staging.your-domain.com
WWW_DOMAIN=www.staging.your-domain.com

# SSL/TLS Settings
SSL_CERTIFICATE_PATH=/etc/letsencrypt/live/${DOMAIN_NAME}/fullchain.pem
SSL_CERTIFICATE_KEY_PATH=/etc/letsencrypt/live/${DOMAIN_NAME}/privkey.pem

# Let's Encrypt Email
LETSENCRYPT_EMAIL=staging@your-domain.com

# Nginx Tuning（本番と同じ）
NGINX_WORKER_PROCESSES=auto
NGINX_WORKER_CONNECTIONS=1024
NGINX_CLIENT_MAX_BODY_SIZE=50M

# ----------------------------------------------------------------------------
# Monitoring Configuration
# ----------------------------------------------------------------------------

# Grafana Settings（ステージング）
GF_SECURITY_ADMIN_USER=admin
GF_SECURITY_ADMIN_PASSWORD=CHANGE_THIS_TO_STRONG_STAGING_PASSWORD
GF_SECURITY_SECRET_KEY=staging_grafana_secret_key_32_chars

GF_SERVER_PROTOCOL=https
GF_SERVER_DOMAIN=grafana.staging.your-domain.com
GF_SERVER_ROOT_URL=https://grafana.staging.your-domain.com

GF_AUTH_ANONYMOUS_ENABLED=false
GF_AUTH_DISABLE_LOGIN_FORM=false

# Prometheus Settings（短めの保持期間）
PROMETHEUS_RETENTION_TIME=15d
PROMETHEUS_STORAGE_TSDB_PATH=/prometheus

# Alertmanager Settings（テスト用Slack/Email）
ALERTMANAGER_SLACK_WEBHOOK_URL=https://hooks.slack.com/services/YOUR/STAGING/WEBHOOK
ALERTMANAGER_EMAIL_TO=staging-alerts@your-domain.com
ALERTMANAGER_EMAIL_FROM=alertmanager@staging.your-domain.com

# ----------------------------------------------------------------------------
# Backup Configuration
# ----------------------------------------------------------------------------

# Backup Directory
BACKUP_DIR=/opt/backups/openclaw_staging
BACKUP_RETENTION_DAYS=14  # ステージングでは短め

# Offsite Backup（ステージングでは別バケット）
AWS_ACCESS_KEY_ID=AKIAIOSFODNN7EXAMPLE
AWS_SECRET_ACCESS_KEY=wJalrXUtnFEMI/K7MDENG/bPxRfiCYEXAMPLEKEY
AWS_S3_BACKUP_BUCKET=your-staging-backup-bucket
AWS_REGION=ap-northeast-1

# ----------------------------------------------------------------------------
# Security Configuration
# ----------------------------------------------------------------------------

# Fail2ban Settings（本番と同じ）
FAIL2BAN_MAXRETRY=5
FAIL2BAN_BANTIME=3600
FAIL2BAN_FINDTIME=600

# UFW Firewall
UFW_ALLOWED_PORTS=22,80,443
UFW_RATE_LIMIT_SSH=yes

# Security Scan Settings
TRIVY_SEVERITY=CRITICAL,HIGH,MEDIUM
SECURITY_SCAN_SCHEDULE=0 2 * * *  # Daily at 2 AM

# ----------------------------------------------------------------------------
# Feature Flags
# ----------------------------------------------------------------------------

# Enable/Disable Features（本番と同じだが、一部テスト用に変更可能）
FEATURE_TELEGRAM_NOTIFICATIONS=true
FEATURE_EMAIL_NOTIFICATIONS=true
FEATURE_SLACK_NOTIFICATIONS=true
FEATURE_AUTO_BACKUP=true
FEATURE_METRICS_COLLECTION=true

# Staging用の追加フラグ
FEATURE_SYNTHETIC_MONITORING=true  # 合成監視（負荷テスト用）
FEATURE_DEBUG_ENDPOINTS=true  # デバッグエンドポイント有効

# ----------------------------------------------------------------------------
# Rate Limiting & Throttling
# ----------------------------------------------------------------------------

# API Rate Limits（本番と同じ）
RATE_LIMIT_WINDOW_MS=900000  # 15 minutes
RATE_LIMIT_MAX_REQUESTS=100

# Request Throttling
THROTTLE_TTL=60
THROTTLE_LIMIT=10

# ----------------------------------------------------------------------------
# Logging Configuration
# ----------------------------------------------------------------------------

# Log Settings（本番と同じ）
LOG_FORMAT=json
LOG_TIMESTAMP_FORMAT=YYYY-MM-DD HH:mm:ss

# Log Rotation
LOG_MAX_SIZE=100M
LOG_MAX_FILES=7  # ステージングでは少なめ
LOG_COMPRESS=true

# ----------------------------------------------------------------------------
# Cache Configuration
# ----------------------------------------------------------------------------

# Redis Settings（ステージング環境）
REDIS_HOST=redis
REDIS_PORT=6379
REDIS_PASSWORD=staging_redis_password_CHANGE_THIS
REDIS_DB=0
CACHE_TTL=3600

# ----------------------------------------------------------------------------
# Email Configuration
# ----------------------------------------------------------------------------

# SMTP Settings for Email Notifications（テスト用）
SMTP_HOST=smtp.gmail.com
SMTP_PORT=587
SMTP_SECURE=false
SMTP_USER=staging-noreply@your-domain.com
SMTP_PASSWORD=your-staging-app-password
SMTP_FROM=noreply@staging.your-domain.com

# ----------------------------------------------------------------------------
# Development/Debug Tools（ステージングでは一部有効）
# ----------------------------------------------------------------------------

# Debug Settings（限定的に有効）
DEBUG=false
VERBOSE=false

# Error Stack Trace（ステージングでは有効）
SHOW_STACK_TRACE=true
ERROR_STACK_TRACE_LIMIT=20

# Performance Profiling（ステージングで有効）
ENABLE_PROFILER=true
ENABLE_MEMORY_PROFILER=true

# Slow Query Logging（本番より厳しめの閾値でテスト）
SLOW_QUERY_THRESHOLD_MS=500
SLOW_REQUEST_THRESHOLD_MS=2000

# Development Tools Access（ステージングでは有効にしても良い）
ADMINER_ENABLED=true  # 必要に応じて
PGADMIN_ENABLED=true  # 必要に応じて

# pgAdmin Settings
PGADMIN_DEFAULT_EMAIL=admin@staging.your-domain.com
PGADMIN_DEFAULT_PASSWORD=CHANGE_THIS_STAGING_PASSWORD

# ----------------------------------------------------------------------------
# Testing Configuration
# ----------------------------------------------------------------------------

# Test Settings（ステージングで負荷テスト等）
ENABLE_LOAD_TESTING=true
LOAD_TEST_MAX_USERS=100
LOAD_TEST_DURATION=300  # 5 minutes

# Test Data
AUTO_SEED_STAGING_DATA=true
SEED_SAMPLE_USERS=true
SEED_SAMPLE_WORKFLOWS=true

# ----------------------------------------------------------------------------
# Synthetic Monitoring（ステージング専用）
# ----------------------------------------------------------------------------

# Uptime Monitoring
SYNTHETIC_CHECK_INTERVAL=300  # 5 minutes
SYNTHETIC_CHECK_ENDPOINTS=/health,/api/status,/n8n

# Performance Budget
RESPONSE_TIME_BUDGET_MS=1000
UPTIME_TARGET_PERCENT=99.5

# ----------------------------------------------------------------------------
# Blue-Green Deployment Support
# ----------------------------------------------------------------------------

# Deployment Strategy
DEPLOYMENT_STRATEGY=blue-green
BLUE_GREEN_ENABLED=true

# Traffic Splitting（カナリアリリース用）
TRAFFIC_SPLIT_PERCENTAGE=100  # 100% = 全トラフィック

# ----------------------------------------------------------------------------
# Cost Tracking（ステージング専用）
# ----------------------------------------------------------------------------

# Cost Tracking Settings
COST_TRACKING_ENABLED=true
COST_BUDGET_WARNING_PERCENT=80
COST_BUDGET_ALERT_PERCENT=100

# Monthly Budget（ステージングは本番の50%程度）
MONTHLY_BUDGET_JPY=2500
MONTHLY_BUDGET_USD=17

# ============================================================================
# ステージング環境チェックリスト
# ============================================================================
#
# デプロイ前に確認:
# [ ] 全てのパスワードが本番とは異なる
# [ ] APIキーがステージング用
# [ ] ドメインがステージングサブドメイン
# [ ] バックアップが別ディレクトリ/バケット
# [ ] 監視アラートがテストチャンネルに送信
# [ ] データが本番と分離されている
#
# ステージング環境の用途:
# - 本番デプロイ前の最終テスト
# - パフォーマンステスト・負荷テスト
# - セキュリティテスト
# - 新機能のユーザーテスト
# - 障害復旧訓練
#
# ============================================================================
