# Nowpattern 運用マニュアル v4.0

> 記事の書き方、フライホイール戦略、X引用リポストの型、パイプライン運用の全てを1箇所に。
> NEO-ONE/TWO、Jarvis、ローカルClaude Codeが参照する唯一の運用基準書。

---

## 1. サイト概要

| 項目 | 内容 |
|---|---|
| URL | https://nowpattern.com |
| CMS | Ghost 5.x（self-hosted、systemd） |
| 言語 | JA: `/` / EN: `/en/` |
| Xアカウント | [@nowpattern](https://x.com/nowpattern) |
| タクソノミー | 3層: ジャンル(12) × イベント(15) × 力学パターン(20) |
| 記事形式 | Deep Pattern（6,000-7,000語）/ Now Report（1,500-2,500語） |

---

## 1.5. 全体像 — 誰が何をやるか

### 登場人物

| 名前 | 正体 | 役割 | 動作環境 |
|---|---|---|---|
| **NEO-ONE** | Claude Opus 4.6 | **記事を書く**。Now Report / Deep Pattern を生成。品質責任者 | VPS（Telegram経由 Claude Code SDK） |
| **NEO-TWO** | Claude Opus 4.6 | NEO-ONEの分身。**並列で記事を書く**。NEO-ONE制限時のフォールバック | VPS（Telegram経由 Claude Code SDK） |
| **Jarvis** | Gemini 2.5 Pro | **投稿・翻訳・実行**。Ghost投稿、X投稿、日英翻訳、スクリプト実行 | VPS（OpenClaw） |
| **ローカル Claude Code** | Claude Opus 4.6 | **設計・開発・運用管理**。スクリプト開発、CLAUDE.md管理、VPS同期 | ローカルPC |
| **cron** | systemd timer | **自動トリガー**。定時でスクリプトを起動する | VPS |
| **オーナー** | 人間 | **戦略判断・GO/NO GO・コスト承認のみ** | スマホ（Telegram） |

### 1記事ができるまでの流れ

```
① cron（10分ごと）
   → x_tweet_collector.py を自動実行
   → 22メディアアカウントの最新ツイートを収集
   → スコアリング → breaking_queue.json に保存

② NEO-ONE または NEO-TWO（キュー監視）
   → breaking_queue.json から未処理ツイートを取得
   → 元ツイートのURLから記事本文をスクレイプ
   → Opus 4.6 で Now Report を執筆（1,500-2,500語）
   → タクソノミータグを自動判定
   → 引用リポスト用コメント（型A/B/C）も同時生成

③ Jarvis または スクリプト（記事完成直後）
   → nowpattern_article_builder.py で HTML化
   → nowpattern_publisher.py で Ghost に投稿
   → JA → /{slug}/ / EN → /en/{slug}/

④ cron（5分ごと）
   → x_quote_repost.py を自動実行
   → article_ready のアイテムを引用リポスト
   → 固定 + 動的ハッシュタグ付与
   → 投稿ログ記録、キューからposted除去
```

### NEO-ONE / NEO-TWO の分担

```
通常時:
  NEO-ONE: キューの前半を処理（奇数番目）
  NEO-TWO: キューの後半を処理（偶数番目）
  → 並列で2倍速

NEO-ONE が制限に到達した場合:
  NEO-ONE: 個人Maxサブスク → 会社Maxサブスクにフォールバック
  NEO-TWO: 会社Maxサブスク → 個人Maxサブスクにフォールバック
  → どちらかが生きていれば記事生成は止まらない

両方制限の場合（稀）:
  → キューに溜まり、制限解除後に自動再開
```

### 人間（オーナー）がやること

- **戦略判断**: 新しいメディアアカウントの追加、テンプレート変更等
- **品質チェック**: Telegramで流れてくる記事をたまに確認
- **承認**: コストが増える変更のGO/NO GO
- **それ以外は全てエージェントが処理**

### 人間がやらなくていいこと

- 記事を書く → NEO-ONE/TWO
- 記事を投稿する → スクリプト（自動）
- Xに投稿する → スクリプト（自動）
- ハッシュタグを考える → スクリプト（自動判定）
- ニュースを探す → スクリプト（自動収集）
- Cookie更新 → Playwright（自動抽出）

---

## 2. ニュースソース収集（X起点パイプライン）

### 仕組み
X API（従量課金）は使わない。**Twikit（cookie認証）で無料**で収集。

```
10分ごと: x_tweet_collector.py
  → 22+メディアアカウントの最新ツイートを巡回
  → キーワードスコアリング + エンゲージメント閾値
  → breaking_queue.json に保存
  → tweet_id が確保されているので引用リポスト元が100%存在する
```

### 巡回対象メディア（22アカウント、拡張可）
**日本語**: @nhk_news, @coin_post, @JpCointelegraph, @Nikkei, @YahooNewsTopics
**英語総合**: @Reuters, @BBCWorld, @AJEnglish, @guardian, @WSJ, @AP, @TIME
**政治地政学**: @thehill, @ForeignPolicy
**テックAI**: @techreview, @TechCrunch
**暗号資産**: @CoinDesk, @Cointelegraph, @WatcherGuru
**経済**: @CNBC, @FT
**速報**: @MarioNawfal

### レート制限
- Twikit search_tweet: 50 req/15min
- 22アカウント × 20秒間隔 ≈ 7.3分/巡回 → 制限内で余裕

---

## 3. 記事フォーマット — v4.0 Flywheel Format

### 設計思想
Stratechery（分析フレームワーク）× Matt Levine（会話的トーン）× Axios（スキャン可能性）
+ Nowpattern独自: 予測追跡 × 力学タクソノミー × 多言語

### 3A. Deep Pattern（旗艦分析、週数本）
6,000-7,000語のStratechery型深層分析。手動制作。

### 3B. Now Report v4.0（1,500-2,500語 — Breaking Pipeline）

全記事共通構造。Opus 4.6で自動生成。5層の Progressive Disclosure（読む深さを読者が選べる）。

```
┌──────────────────────────────────────────────┐
│  BOTTOM LINE（3秒で核心を理解）              │ ← Layer 1: スキャナー向け
│  パターン名 / 基本シナリオ / 注目ポイント     │
└──────────────────────────────────────────────┘

タグバッジ: #ジャンル #イベント #力学パターン

Why it matters: なぜ重要か（2-3文）           ← Layer 2: 30秒読者

── What happened ──                            ← Layer 3: 3分読者
  事実の要約（300語）。各段落の最重要フレーズは太字。

── The Big Picture ──
  歴史的文脈 / 利害関係者マップ / データ

  ┌────────────────────────────────────────────┐
  │  Between the Lines — 行間を読む            │ ← 最もシェアされる部分
  │  公式発表が「言っていないこと」を分析      │
  └────────────────────────────────────────────┘

── NOW PATTERN（ダークボックス）──              ← Layer 4: 10分読者
  力学タグ名 × 力学タグ名
  力学の要約
  詳細分析（太字強調あり）
  交差点分析

── Pattern History ──
  歴史的並行事例（構造的類似性を明示）

── What's Next ──
  楽観シナリオ（30%）+ 示唆
  基本シナリオ（50%）+ 示唆
  悲観シナリオ（20%）+ 示唆
  注目トリガー

  ┌────────────────────────────────────────────┐
  │  Next — 追跡ポイント                       │ ← Layer 5: Open Loop
  │  次のトリガー: [具体的日付+イベント]        │   ツァイガルニク効果で再訪を促す
  │  このパターンの続き: [次の追跡テーマ]       │
  │  Prediction ID: NP-2026-0001              │   予測追跡DBに自動記録
  └────────────────────────────────────────────┘

── Footer ──
  関連記事 / ソース
```

### v4.0 新要素の詳細

| 要素 | 目的 | 行動心理学 |
|------|------|-----------|
| **Bottom Line** | 3秒で記事価値を判断→深読みへ誘導 | コミットメント段階化 |
| **Between the Lines** | 「裏の話」=最もシェアされるコンテンツ | 好奇心ギャップ |
| **太字強調** | スキャン読みでも要点が伝わる | Axios Smart Brevity |
| **Open Loop** | 未完結の情報→脳が記憶→再訪 | ツァイガルニク効果 |
| **Prediction ID** | 予測→検証→精度スコア=信頼資産 | 損失回避（見逃し恐怖） |
| **会話的トーン** | Matt Levine式=読者の知性を尊重 | 変動報酬（予想外の語り口） |

### 見出し言語ルール
- **日本語記事**: 全見出し日本語（「何が起きたか」「なぜ重要か」等）
- **英語記事**: 全見出し英語（"What Happened", "Why It Matters" 等）
- **混在禁止**: 日本語記事に英語見出しを入れない

---

## 4. タグ付けルール

### 必須タグ（全記事）
| タグ | 用途 |
|---|---|
| `nowpattern` | サイト固定タグ |
| `lang-ja` or `lang-en` | 言語識別（URLルーティングに使用） |

### 3層タクソノミータグ（全記事に1つ以上ずつ）

**第1層: ジャンル（13個）**（記事の分野）
地政学・安全保障 / 経済・貿易 / 金融・市場 / ビジネス・産業 / テクノロジー / 暗号資産 / エネルギー / 環境・気候 / ガバナンス・法 / 社会 / 文化・エンタメ・スポーツ / メディア・情報 / 健康・科学

**第2層: イベントタグ（19個）**（何が起きたか）
軍事衝突 / 制裁・経済戦争 / 貿易・関税 / 規制・法改正 / 選挙・政権交代 / 市場ショック / 技術進展 / 条約・同盟変動 / 資源・エネルギー危機 / 司法・裁判 / 災害・事故 / 健康危機・感染症 / サイバー攻撃 / 社会不安・抗議 / 構造シフト / 事業再編・取引 / 競争・シェア争い / スキャンダル・信頼危機 / 社会変動・世論

**第3層: 力学タグ（NOWパターン）（16個 = 4×4）**（なぜそうなるのか）
**支配**: プラットフォーム支配 / 規制の捕獲 / 物語の覇権 / 権力の過伸展
**対立**: 対立の螺旋 / 同盟の亀裂 / 経路依存 / 揺り戻し
**崩壊**: 制度の劣化 / 協調の失敗 / モラルハザード / 伝染の連鎖
**転換**: 危機便乗 / 後発逆転 / 勝者総取り / 正統性の空白

### タグ付けの原則
- ジャンル: 1-2個（メインジャンル + サブがある場合）
- イベント: 1個（最も適切なもの）
- 力学: 1-2個（記事で分析する力学）
- **存在しないタグを作らない** — 上記リストから選ぶ

---

## 5. X引用リポスト戦略

### Xアルゴリズムの重み付け（公式オープンソースより）

| エンゲージメント | 重み | 戦略的意味 |
|---|---|---|
| リプライにリプライが付く | **75x** | **最重要。問いかけでリプライを誘発** |
| リプライ | 13.5x | いいねの27倍の価値 |
| プロフィールクリック | 12x | 興味を引く1行目が重要 |
| ブックマーク | 10x | 保存したくなる分析の深さ |
| リツイート | 1x | ベースライン |
| いいね | 0.5x | 最も軽い |

**結論**: いいね100個よりリプライ2件の方がアルゴリズム上有利。

### ハッシュタグ戦略

#### 固定ハッシュタグ（全投稿に必須）
```
#Nowpattern #ニュース分析
```

#### 動的ハッシュタグ（記事内容に応じて1-2個追加）

**ジャンル系**（記事のジャンルから選択）
| ジャンル | JA用ハッシュタグ | EN用ハッシュタグ |
|---|---|---|
| 地政学 | #地政学 | #Geopolitics |
| 経済 | #経済分析 | #Economy |
| 金融 | #金融市場 | #Finance |
| テクノロジー | #テック | #Tech |
| 暗号資産 | #暗号資産 | #Crypto |
| エネルギー | #エネルギー | #Energy |
| AI | #AI | #AI |
| 政治 | #政治 | #Politics |

**話題系**（その時のトレンドに合わせて）
| トピック | ハッシュタグ例 |
|---|---|
| トランプ関連 | #Trump #トランプ |
| 中東情勢 | #MiddleEast #中東 |
| EU規制 | #EU #DMA |
| ビットコイン | #BTC #Bitcoin |
| 日銀 | #日銀 #BOJ |
| ウクライナ | #Ukraine #ウクライナ |

#### ハッシュタグのルール
- **合計3-4個**（固定2 + 動的1-2）
- 5個以上はスパム判定リスク
- トレンド入りしているハッシュタグを優先
- 日本語記事は日本語タグ、英語記事は英語タグ

---

## 6. 引用リポストのテンプレート

### 型A: 裏読み型（メイン — 70%使用）

**狙い**: 好奇心ギャップ → 記事クリック + リプライ誘発

```
このニュースの本当の意味を誰も言っていない。

[元ツイートの要約]の裏にあるのは[力学タグ名]の構造。
[1文で核心]

なぜそう言えるか → nowpattern.com/xxxxx

あなたはどう読みますか？

#Nowpattern #ニュース分析 #[動的タグ]
```

**要素分解**:
- 1行目: 好奇心ギャップ（「誰も言っていない」）
- 中段: 権威性（独自フレームワーク = 力学タグ）
- リンク前: 「なぜ」で記事への誘導
- 最終行: **問いかけ = リプライ誘発（75x重み狙い）**

### 型B: シナリオ型（25%使用）

**狙い**: 認知的関与 → リプライで予測を語らせる

```
[事実の1行要約]

3つのシナリオ:
楽観: [1行]
基本: [1行]
悲観: [1行]

根拠と確率 → nowpattern.com/xxxxx

どのシナリオだと思いますか？

#Nowpattern #ニュース分析 #[動的タグ]
```

### 型C: 反直感型（5%使用 — バズ狙い）

**狙い**: 認知的不協和 → 議論誘発

```
これは[一般的な解釈]ではない。[逆の解釈]だ。

[1文で根拠]
同じパターンは[過去事例]で起きている。

全分析 → nowpattern.com/xxxxx

#Nowpattern #ニュース分析 #[動的タグ]
```

### 共通ルール

| ルール | 理由 |
|---|---|
| 1行目で止める | スクロール停止 = インプレッション |
| リンクは本文に直接含める | nowpattern.comの記事URL（v3.0: Xリンクペナルティ撤廃対応） |
| 最後に問いかけ | リプライ誘発 = アルゴリズム75x |
| 200字以内 | 展開不要で全文表示される |
| 画像なし | 引用リポストが元ツイートをプレビュー表示 |
| 絵文字は最小限 | 権威性を損なう。0-1個 |

### 言語ルール
| 条件 | 引用リポストの言語 |
|---|---|
| JA記事 + JA元ツイート | 日本語 |
| JA記事 + EN元ツイート | 日本語（読者ターゲットに合わせる） |
| EN記事 + EN元ツイート | 英語 |
| EN記事 + JA元ツイート | 英語 |

---

## 7. 投稿スケジュール

### 引用リポスト
- **間隔**: 5分以上（X制限を守る）
- **1日の目標**: 100件以上
- **時間帯**: 24時間自動（cron）
- **重複防止**: tweet_id ベースで同じツイートを2回引用しない

### 記事投稿
- **Ghost**: 記事生成直後に自動投稿
- **JA記事**: `/{slug}/`
- **EN記事**: `/en/{slug}/`

---

## 8. パイプライン全体フロー

```
[10分ごと] x_tweet_collector.py
  22メディアのXツイート巡回
  ↓ スコアリング + エンゲージメント閾値
  ↓ breaking_queue.json に保存

[5分ごと] neo_article_writer.py
  NEO-ONE/TWO がキューを監視
  ↓ Opus 4.6 で Now Report 生成
  ↓ nowpattern_article_builder.py で HTML化
  ↓ nowpattern_publisher.py で Ghost投稿
  ↓ タクソノミータグ自動付与

[5分間隔] x_quote_repost.py v3.0
  breaking_queue.json から article_ready を取得
  ↓ テンプレート（型A/B/C）で引用リポスト生成
  ↓ リンクを本文に直接含める方式（2025年10月のXリンクペナルティ撤廃対応）
  ↓ create_tweet(text) — リプライ分離戦略は廃止
  ↓ ハッシュタグ: 固定2 + 動的1-2
  ↓ 投稿ログ記録
```

---

## 9. Cookie管理

### X Cookie（Twikit用）
- **ファイル**: `/opt/.x-cookies.json`
- **取得方法**: Playwright で Chrome プロファイルから抽出
- **更新**: Cookie期限切れ時に `python3 /tmp/pw_extract.py` を実行
- **アカウント**: @nowpattern

### 重要な Cookie
| Cookie名 | 役割 |
|---|---|
| auth_token | 認証トークン（最重要） |
| ct0 | CSRF トークン |
| twid | ユーザーID |

---

## 10. 堀（Moat）戦略 — Intelligence Flywheel

### なぜ「フォーマット」だけではモートにならないか

AI時代では、記事構造・TL;DR・太字強調などの**フォーマット**は誰でもコピーできる。
ChatGPTにテンプレートを食わせれば同じ構造の記事を量産可能。

**真のモートは「時間をかけないと作れないもの」だけ。**

### Nowpattern Intelligence Flywheel（複利ループ）

```
[1. 記事生成]
  Opus 4.6がニュース分析 + 3シナリオ予測
  → 各予測を構造化DB（prediction_db.json）に自動記録
      ↓
[2. 予測追跡]
  トリガーイベントをニュース監視で自動検出
  → 予測が当たったか判定 → Brier Score計算
      ↓
[3. 精度改善]
  過去の予測結果パターンを分析
  → 「Nowpatternのこの力学の予測精度74%」
  → 次の記事生成時にこの精度データを参照
      ↓
[4. 信頼資産の蓄積]
  「Nowpatternの2026年予測精度: 68%」
  → これは3年間蓄積しないと得られない
  → 他サイトが真似しようとしても3年遅れ
      ↓
[5. 読者の信頼 → 再訪 → さらにデータ蓄積]
      ↓
[1に戻る]（フライホイールが加速）
```

### 4つの堀と複製コスト

| # | 堀 | なぜモートか | 複製コスト |
|---|-----|-------------|-----------|
| 1 | **予測トラックレコード** | 3年分の「予測→結果」データは1日で作れない | 最低3年 |
| 2 | **自己参照ナレッジグラフ** | 12万記事の力学×パターン相互引用網 | 記事数に比例して指数的価値増加 |
| 3 | **検証ループ** | 予測精度が「証明された実績」になる | 実績は偽造不可能 |
| 4 | **Opus品質 × 量 × X配信** | 1日100本のOpus品質 + 引用リポスト | Maxサブスク×2 = $400/月が必要 |

### Format Evolver（世界最高峰を維持する仕組み）

**「常に世界最高峰」であるためには、世界を常にスキャンして取り込む仕組みが必要。**

```
[月1回自動実行: format_evolver.py]
  1. 世界のトップ10ニュースレターの最新記事を取得
     (Stratechery, Money Stuff, Axios, Morning Brew, The Hustle,
      The Information, Sinocism, Ben Evans, Kyla Scanlon, Doomberg)
  2. Opus 4.6が構造・トーン・新テクニックを分析
  3. 「Nowpatternフォーマットに取り入れるべき要素」をリスト化
  4. NEO記事執筆指示を自動アップデート
  5. 次回以降の記事生成に反映
  → Nowpatternのフォーマットが毎月自動で世界最高水準に更新
```

### 予測追跡システム（Prediction Tracker）

| 項目 | 内容 |
|------|------|
| **記録** | 全記事の3シナリオ+確率をprediction_db.jsonに自動保存 |
| **ID形式** | NP-YYYY-XXXX（例: NP-2026-0042） |
| **スコア** | Brier Score（0=完璧、0.25=スキルなし、Superforecaster=0.15-0.20） |
| **判定** | トリガーイベント監視（RSS/ニュース）→ 自動or手動で結果判定 |
| **公開** | 四半期ごとに「予測精度レポート」を記事として公開 |
| **校正曲線** | 「70%と予測したものは実際に70%の確率で的中」を可視化 |
| **トラックレコードページ** | `/predictions/` — 予測トラックレコード公開ページ。`update_predictions_page.py` で自動更新（cron 毎日 JST 15:05） |
| **overdue通知** | `prediction_tracker.py` の overdue チェック — cron 毎日 JST 9:00 で実行 |

**Brier Score計算式:**
```
Brier Score = (1/N) × Σ(予測確率 - 実際の結果)²
0.00 = 完璧（ありえない）
0.15 = Superforecaster級
0.25 = 「全部50/50」と同じ（スキルなし）
1.00 = 全問逆回答
```

### Nowpattern Intelligence System 全体構成図

```
┌─────────────────────────────────────────────────────┐
│            Nowpattern Intelligence System             │
├─────────────┬────────────┬────────────┬──────────────┤
│  Article    │ Prediction │ Knowledge  │   Format     │
│  Engine     │ Tracker    │ Graph      │   Evolver    │
│             │            │            │              │
│ Opus v4.0   │ 予測記録   │ 力学×記事  │ 世界トップ10 │
│ 記事自動生成│ 自動判定   │ 相互引用   │ 月次スキャン │
│ (Pipeline)  │ Brier Score│ (Index)    │ 指示書更新   │
├─────────────┴────────────┴────────────┴──────────────┤
│               Flywheel（複利ループ）                   │
│ 記事 → 予測 → 検証 → 精度UP → 信頼 → 読者 → 記事   │
└─────────────────────────────────────────────────────┘
```

### 世界トップとの比較（競争優位マトリクス）

| 要素 | Stratechery | Matt Levine | Axios | Morning Brew | **Nowpattern v4** |
|------|:-----------:|:-----------:|:-----:|:------------:|:-----------------:|
| 分析フレームワーク | ○ | - | - | - | **○（12力学タグ）** |
| 歴史的文脈 | ○ | ○ | - | - | **○** |
| 予測追跡+スコア | - | - | - | - | **○（唯一）** |
| 会話的トーン | ○ | ○ | - | ○ | **○** |
| 視覚フォーマット | - | - | ○ | ○ | **○** |
| 多言語 | - | - | - | - | **○（唯一）** |
| TL;DR/Bottom Line | - | - | ○ | - | **○** |
| Between the Lines | - | ○ | - | - | **○** |
| Open Loop | - | ○ | - | - | **○** |
| 自動フォーマット進化 | - | - | - | - | **○（唯一）** |

**「予測追跡 × 力学フレームワーク × 自動フォーマット進化 × 多言語」の組み合わせは世界に存在しない。**

---

## 11. コスト構造（追加$0）

| 項目 | 月額 | 用途 |
|---|---|---|
| 個人 Claude Max 20x | $200 | NEO-ONE/TWO（記事生成） |
| 会社 Claude Max 20x | $200 | NEO-ONE/TWO（フォールバック） |
| X投稿 | $0 | Twikit（cookie認証） |
| Xツイート収集 | $0 | Twikit（cookie認証） |
| VPS・Ghost | $0 | 既存 |
| **合計** | **$400** | **全て既存サブスク・追加$0** |

---

## 12. Ghost CMS ホスティング戦略

### 現在の構成
- **方式**: セルフホスト（VPS上に直接インストール）
- **ライセンス**: MIT（完全オープンソース、無料）
- **DB**: SQLite
- **コスト**: $0（VPS代は既存インフラに含まれる）
- **Admin API**: HTTPS化完了。`/opt/cron-env.sh` の `GHOST_URL` は `https://nowpattern.com` に設定済み。HTTP→HTTPSリダイレクトで403エラーが出ていた問題を修正済み
- **Schema Markup**: Ghost Code Injection（header）に `NewsMediaOrganization` + `WebSite` JSON-LD を追加済み（Google SEO対策）
- **ディスクレーマー**: Ghost Code Injection（footer）にJA/EN二言語の投資助言免責事項を追加済み

### セルフホスト vs Ghost Pro（有料）

| 項目 | セルフホスト（今） | Ghost Pro |
|---|---|---|
| ソフトウェア代 | **$0（永久無料）** | $18〜$199+/月 |
| 記事数 | **無制限** | 無制限 |
| メンバー数 | **無制限** | 1,000〜10,000人 |
| ストレージ | **VPSの容量次第** | 5MB〜1GB |
| メール送信 | 自分で設定 | 含まれる |
| CDN | Caddy + 自前 | 含まれる |
| 管理の手間 | NEOが対応 | ゼロ |

**結論: Ghost Proにする理由はゼロ。セルフホストを継続。**

### 記事数が増えた場合のスケール見通し

| 記事数 | 時期（目安） | 追加コスト | 必要な対応 |
|---|---|---|---|
| 〜1,000記事 | 〜3ヶ月 | $0 | 何もしない |
| 〜10,000記事 | 〜3ヶ月（100記事/日） | $0 | SQLite → MySQL移行を検討 |
| 〜100,000記事 | 〜3年 | $0〜$5/月 | MySQL + 画像外部ストレージ（Cloudflare R2 無料枠超過時） |
| 100,000記事+ | 3年以上 | $5〜$10/月 | VPSスペックアップの可能性 |

### データサイズ試算
- テキスト記事1本: 約5〜20KB
- 画像なし10万記事: 約1〜2GB
- Ghost自体のメモリ: 約200〜300MB（記事数に依存しない）

### SQLite → MySQL移行の判断基準
- 記事検索やフィルタが遅くなったと感じたら移行
- 目安は記事数10,000〜50,000
- MySQL/MariaDBはVPS上で無料で動かせる（追加コスト$0）
- 移行手順: `ghost setup mysql` → データインポート → 動作確認

### 画像ストレージ戦略
- 現在: VPSローカルストレージ（Ghost標準）
- 将来: Cloudflare R2に移行（無料枠10GB、超過後$0.015/GB/月）
- Ghost標準の画像アップロードはローカル保存だが、Cloudflare CDNで配信すれば速度も問題なし

---

## 13. パイプライン実装状況（2026-02-21更新）

| コンポーネント | ステータス | 備考 |
|---|---|---|
| x_tweet_collector.py | **稼働中** | VPSデプロイ済、cron `*/10` 設定済。22アカウント、372ツイート/回収集 |
| neo_article_writer.py | **稼働中** | VPSデプロイ済、cron `*/5` 設定済。Telethon経由でNEOに指示 |
| breaking_pipeline_helper.py | **稼働中** | NEOが記事JSON作成後に呼び出す。Ghost投稿+キュー更新 |
| breaking_article_template.json | **配置済** | NEOが参照するJSONテンプレート |
| x_quote_repost.py | **v3.0 稼働中** | cron `*/5` 設定済。リンクを本文に直接含める方式に変更（2025年10月Xリンクペナルティ撤廃対応）。リプライ分離戦略は廃止 |
| x-auto-post.py | **完成** | 引用リポスト対応済 |
| /opt/.x-cookies.json | **取得済** | auth_token, ct0, twid（2026-02-21更新） |
| NEOデュアルサブスク | **未設定** | 会社Max OAuthトークン未取得 |

### 本番テスト結果（2026-02-21）

- ツイート収集: 22アカウント → 372ツイート → 10件キューイン ✅
- NEO記事生成: NEO-ONEに1件送信 → 4記事自動生成（17K+ chars/記事） ✅
- Ghost投稿: 4記事published ✅
- X引用リポスト: **エラー226でブロック** ❌（→ v3.0で方式変更済み）
- article_index: 既存37記事のバックフィル完了 ✅

### 未解決の問題

**1. Xエラー226（bot検出）**
- 症状: `create_tweet` がXから「自動化リクエスト検出」で拒否される
- 原因: @nowpattern アカウントがbot検出に引っかかっている
- 解除方法: VPSデスクトップ（RDP）からブラウザで手動ツイート1-2件 → 数時間待機

**2. NEOセキュリティフィルタ**
- 症状: JSON/コードブロック含む指示が「dangerous characters」でブロック
- 修正済み: バッククォート/コードブロックを除去、テンプレートファイル参照方式に変更
- 検証済み: 新フォーマットは96.4%がフィルタ通過（50%閾値をクリア）

**3. NEOデュアルサブスク未設定**
- NEO-ONE/TWO共に個人Maxのみ。会社Maxフォールバック未設定
- 設定手順: 会社MaxでVPSからClaude Codeログイン → OAuthトークン取得

### 解決済みの問題（2026-02-22更新）

**1. healthcheck.sh v2 — 通知スパム修正**
- 症状: healthcheck.shが毎回Telegram通知を送信し、スパム化していた
- 修正: v2に更新。**状態変化時のみ**Telegram通知を送信する方式に変更

**2. crontab重複削除**
- 189行 → 169行に整理。重複エントリを削除

**3. article_index バックフィル完了**
- 既存37記事を `nowpattern_article_index.json` にバックフィル完了

### cron設定

```
# Breaking Pipeline（2026-02-22更新、crontab 169行に整理済み）
*/10 * * * * x_tweet_collector.py        → breaking-collector.log
*/5  * * * * neo_article_writer.py       → breaking-writer.log
*/5  * * * * x_quote_repost.py (v3.0)    → breaking-repost.log

# Prediction & Monitoring
0  0  * * * prediction_tracker.py overdue → JST 9:00（毎日）
5  6  * * * update_predictions_page.py   → JST 15:05（毎日）
```

---

*最終更新: 2026-02-22 — v1.3 x_quote_repost v3.0（リンク本文直接方式）、Ghost HTTPS化完了、Schema Markup追加、ディスクレーマー追加、/predictions/ページ作成、healthcheck.sh v2（状態変化通知）、crontab整理（189→169行）、article_index 37記事バックフィル完了*
