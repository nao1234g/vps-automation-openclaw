# Alertmanager Configuration
global:
  resolve_timeout: 5m

# ã‚¢ãƒ©ãƒ¼ãƒˆé€šçŸ¥å…ˆã®è¨­å®š
route:
  group_by: ['alertname', 'severity', 'category']
  group_wait: 10s
  group_interval: 10s
  repeat_interval: 12h
  receiver: 'default'

  # ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£åˆ¥ã®ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°
  routes:
    # Critical: å³åº§ã«é€šçŸ¥
    - match:
        severity: critical
      receiver: 'critical-alerts'
      group_wait: 0s

    # Warning: ã¾ã¨ã‚ã¦é€šçŸ¥
    - match:
        severity: warning
      receiver: 'warning-alerts'
      group_wait: 30s

    # System: ã‚·ã‚¹ãƒ†ãƒ ã‚¢ãƒ©ãƒ¼ãƒˆ
    - match:
        category: system
      receiver: 'system-alerts'

    # Database: ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚¢ãƒ©ãƒ¼ãƒˆ
    - match:
        category: database
      receiver: 'database-alerts'

# é€šçŸ¥å…ˆï¼ˆReceiverï¼‰ã®å®šç¾©
receivers:
  # ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆé€šçŸ¥å…ˆ
  - name: 'default'
    webhook_configs:
      - url: 'http://openclaw:3000/api/alerts/webhook'
        send_resolved: true

  # Critical: Telegramé€šçŸ¥
  - name: 'critical-alerts'
    webhook_configs:
      - url: 'http://openclaw:3000/api/alerts/critical'
        send_resolved: true
    # TelegramãŒè¨­å®šã•ã‚Œã¦ã„ã‚‹å ´åˆ
    # telegram_configs:
    #   - bot_token: '${TELEGRAM_BOT_TOKEN}'
    #     chat_id: ${TELEGRAM_CHAT_ID}
    #     parse_mode: 'HTML'
    #     message: |
    #       ğŸš¨ <b>CRITICAL ALERT</b>
    #       {{ range .Alerts }}
    #       Alert: {{ .Labels.alertname }}
    #       Summary: {{ .Annotations.summary }}
    #       Description: {{ .Annotations.description }}
    #       {{ end }}

  # Warning: é€šå¸¸ã‚¢ãƒ©ãƒ¼ãƒˆ
  - name: 'warning-alerts'
    webhook_configs:
      - url: 'http://openclaw:3000/api/alerts/warning'
        send_resolved: true

  # System: ã‚·ã‚¹ãƒ†ãƒ ã‚¢ãƒ©ãƒ¼ãƒˆ
  - name: 'system-alerts'
    webhook_configs:
      - url: 'http://openclaw:3000/api/alerts/system'
        send_resolved: true

  # Database: ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚¢ãƒ©ãƒ¼ãƒˆ
  - name: 'database-alerts'
    webhook_configs:
      - url: 'http://openclaw:3000/api/alerts/database'
        send_resolved: true

# æŠ‘åˆ¶ãƒ«ãƒ¼ãƒ«ï¼ˆåŒã˜ã‚¢ãƒ©ãƒ¼ãƒˆãŒç¹°ã‚Šè¿”ã—é€šçŸ¥ã•ã‚Œãªã„ã‚ˆã†ã«ï¼‰
inhibit_rules:
  - source_match:
      severity: 'critical'
    target_match:
      severity: 'warning'
    equal: ['alertname', 'instance']

  - source_match:
      alertname: 'CriticalDiskUsage'
    target_match:
      alertname: 'HighDiskUsage'
    equal: ['instance']
