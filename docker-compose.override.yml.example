# Docker Compose Override Example
# このファイルをコピーして使用: cp docker-compose.override.yml.example docker-compose.override.yml
#
# docker-compose.override.ymlは自動的に読み込まれ、docker-compose.production.ymlの
# 設定を上書きします。開発環境でのカスタマイズに使用してください。
#
# 注意: docker-compose.override.ymlは.gitignoreに含まれており、
# コミットされません（個人設定のため）

version: '3.8'

services:
  # OpenClaw カスタマイズ例
  openclaw:
    # ローカルコードをマウントしてホットリロード有効化
    volumes:
      - ./local/openclaw:/app
    # デバッグポート公開
    ports:
      - "9229:9229"  # Node.js debugger
    # 環境変数の上書き
    environment:
      - NODE_ENV=development
      - DEBUG=*
      - LOG_LEVEL=debug
    # コマンドの上書き（nodemonでホットリロード）
    command: npx nodemon --inspect=0.0.0.0:9229 src/index.js

  # N8N カスタマイズ例
  n8n:
    # ローカルカスタムノードをマウント
    volumes:
      - ./local/n8n/custom-nodes:/home/node/.n8n/custom
      - ./local/n8n/workflows:/home/node/.n8n/workflows
    # 環境変数の上書き
    environment:
      - N8N_LOG_LEVEL=debug
      - EXECUTIONS_DATA_SAVE_ON_ERROR=all
      - EXECUTIONS_DATA_SAVE_ON_SUCCESS=all
      - EXECUTIONS_DATA_SAVE_MANUAL_EXECUTIONS=true

  # OpenNotebook カスタマイズ例
  opennotebook:
    # ローカルコードをマウント
    volumes:
      - ./local/opennotebook:/app
    # 環境変数の上書き
    environment:
      - DEBUG=true
      - PYTHONUNBUFFERED=1

  # PostgreSQL カスタマイズ例
  postgres:
    # ローカルSQLスクリプトをマウント
    volumes:
      - ./local/postgres/init:/docker-entrypoint-initdb.d
      - ./local/postgres/backups:/backups
    # ポート公開（ローカルからの直接接続用）
    ports:
      - "5432:5432"
    # PostgreSQL設定の上書き
    command:
      - "postgres"
      - "-c"
      - "log_statement=all"
      - "-c"
      - "log_duration=on"
      - "-c"
      - "log_min_duration_statement=0"

  # Nginx カスタマイズ例
  nginx:
    # カスタム設定ファイルをマウント
    volumes:
      - ./local/nginx/nginx.conf:/etc/nginx/nginx.conf:ro
      - ./local/nginx/conf.d:/etc/nginx/conf.d:ro
    # ログレベルの変更
    environment:
      - NGINX_LOG_LEVEL=debug

  # 開発用ツール: Adminer（データベース管理GUI）
  adminer:
    image: adminer:latest
    container_name: adminer
    restart: unless-stopped
    ports:
      - "8088:8080"
    networks:
      - backend
    environment:
      - ADMINER_DEFAULT_SERVER=postgres
      - ADMINER_DESIGN=nette

  # 開発用ツール: Redis（キャッシュ用）
  redis:
    image: redis:7-alpine
    container_name: redis
    restart: unless-stopped
    ports:
      - "6379:6379"
    networks:
      - backend
    volumes:
      - redis_data:/data
    command: redis-server --appendonly yes --requirepass ${REDIS_PASSWORD:-devpassword}

  # 開発用ツール: MailHog（メールテスト用SMTPサーバー）
  mailhog:
    image: mailhog/mailhog:latest
    container_name: mailhog
    restart: unless-stopped
    ports:
      - "1025:1025"  # SMTP
      - "8025:8025"  # Web UI
    networks:
      - backend

  # 開発用ツール: pgAdmin（PostgreSQL GUI）
  pgadmin:
    image: dpage/pgadmin4:latest
    container_name: pgadmin
    restart: unless-stopped
    ports:
      - "5050:80"
    networks:
      - backend
    environment:
      - PGADMIN_DEFAULT_EMAIL=${PGADMIN_EMAIL:-admin@localhost}
      - PGADMIN_DEFAULT_PASSWORD=${PGADMIN_PASSWORD:-admin}
    volumes:
      - pgadmin_data:/var/lib/pgadmin

networks:
  frontend:
    # フロントエンドネットワークは既存の設定を継承
  backend:
    # バックエンドネットワークは既存の設定を継承

volumes:
  redis_data:
    driver: local
  pgadmin_data:
    driver: local
